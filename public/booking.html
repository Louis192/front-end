<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
</head>

<body>
    <h1>Hello, world!</h1>

    <form action="bookings" method="POST" onsubmit="updateBooking(event);">

        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Academic Year</label>
            <select name="Academic Year" class="form-select" aria-label="Default select example"
                onchange="SelectYear(this.value)">
                <option selected>Open this select menu</option>
                <option value="2009">2009</option>
                <option value="2010">2010</option>
            </select>
        </div>
        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Level Of Study</label>
            <select name="Level Of Study" class="form-select" aria-label="Default select example"
                onchange="SelectLevel(this.value)">
                <option selected>Open this select menu</option>
                <option value="Research Postgraduate">Research Postgraduate</option>
                <option value="Sub degree">Sub degree</option>
            </select>
        </div>
        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Level Of Study</label>
            <select name="Level Of Study" class="form-select" aria-label="Default select example"
                onchange="SelectLevel(this.value)">
                <option selected>Open this select menu</option>
                <option value="Research Postgraduate">Research Postgraduate</option>
                <option value="Sub degree">Sub degree</option>
            </select>
        </div>
        <div class="row mb-3">
            <label class="col-sm-2 col-form-label">Faculty</label>
            <select name="Faculty" class="form-select" aria-label="Default select example"
                onchange="SelectLevel(this.value)">
                <option selected>Open this select menu</option>
                <option value="Social Sciences">Social Sciences</option>
                <option value="Engineering">Engineering</option>
                <option value="Medicine">Medicine</option>
                <option value="Education">Education</option>
                <option value="Sciences">Sciences</option>
            </select>
        </div>
        <div class="row mb-3">
            <label for="inputPassword3" class="col-sm-2 col-form-label">Average Salary</label>
            <div class="col-sm-10">
                <input type="number" class="form-control" id="inputPassword3" min=3 max=4 name="Salary">
            </div>

        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="button" class="btn btn-danger" onclick="deleteBooking()">Delete</button>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <script>
        var avengers = ["Captain America", "Iron Man", "Thor", "Hulk", "Black Widow", "Hawkeye"];
        var jla = ["Superman", "Batman", "Wonder Woman", "Flash", "Green Lantern", "Aquaman"];

        function teamSelected(team) {
            //alert(team);
            var superheroElem = document.getElementById("superhero");
            superheroElem.options.length = 0;
            if (team == "Avengers") {

                for (var hero of avengers) {
                    var option = document.createElement("option");
                    option.text = hero;
                    option.value = hero;
                    superheroElem.add(option);
                }

                superheroElem.disabled = false;

            } else if (team == "JLA") {

                for (var hero of jla) {
                    var option = document.createElement("option");
                    option.text = hero;
                    option.value = hero;
                    superheroElem.add(option);
                }

                superheroElem.disabled = false;

            } else {

                superheroElem.disabled = true;
            }
        }

    </script>
    <script>


        async function fetchBooking() {
            var response = await fetch("/api/bookings/" + id);
            if (response.ok) {
                var data = await response.json();
                document.querySelector("#inputEmail3").value = data.email;
                document.querySelector("#inputPassword3").value = data.numTickets;
                document.querySelector(`option[value='${data.team}']`).selected = true;
                teamSelected(data.team)
                document.querySelector(`option[value='${data.superhero}']`).selected = true;
                document.querySelector(`input[value='${data.payment}']`).checked = true;
                document.querySelector("#gridCheck1").checked = data.terms;
            }
        }
        const urlParams = new URLSearchParams(window.location.search);
        let id = urlParams.get("id")
        fetchBooking();

        async function updateBooking(event) {

            event.preventDefault();

            var response = await fetch("/api/bookings/" + id, {
                method: "put",
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                // body: "team=Avengers&superhero=Hulk"
                body: new URLSearchParams(new FormData(event.target))
            });

            if (response.ok) {
                var text = await response.text();
                alert(text);
                location.assign("/bookings");
            } else {
                alert(response.statusText)
            }
        }

        async function deleteBooking() {

            var r = confirm("Confirm Delete?");

            if (r) {

                var response = await fetch("/api/bookings/" + id, {
                    method: "delete",
                });

                if (response.ok) {
                    alert("booking deleted");
                    location.assign("/bookings")
                } else {
                    alert(response.statusText)
                }
            } else {
                alert("cancelled");
            }
        }
    </script>


</body>

</html>